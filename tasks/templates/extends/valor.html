<div class="tab-content" id="tab-valor">
    <div class="section">
        <div class="separador">
            <h4>Datos Contables</h4>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.valor_contable.id_for_label }}">Valor Contable (S):</label>
                {{ form.valor_contable }}
            </div>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.fecha_valor_contable.id_for_label }}">Fecha Valor Contable:</label>
                {{ form.fecha_valor_contable }}
            </div>
        </div>
        
        <div class="separador">
            <h4>Datos Asegurables (S)</h4>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.valor_asegurable.id_for_label }}">Valor Asegurable (S):</label>
                {{ form.valor_asegurable }}
            </div>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.fecha_valor_asegurable.id_for_label }}">Fecha Valor Asegurable:</label>
                {{ form.fecha_valor_asegurable }}
            </div>
        </div>
        
        <div class="separador">
            <h4>Datos de Adquisición</h4>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.valor_adquisicion.id_for_label }}">Valor de Adquisición (S):</label>
                {{ form.valor_adquisicion }}
            </div>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.fecha_valor_adquisicion.id_for_label }}">Fecha de Valor de Adquisición (es):</label>
                {{ form.fecha_valor_adquisicion }}
            </div>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.valor_terreno.id_for_label }}">Valor de Terreno (S):</label>
                {{ form.valor_terreno }}
            </div>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.valor_construccion.id_for_label }}">Valor de Construcción (S):</label>
                {{ form.valor_construccion }}
            </div>
        </div>
        
        <div class="separador">
            <h4>Datos Catastrales</h4>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.valor_catastral_terreno.id_for_label }}">Valor Catastral del Terreno:</label>
                {{ form.valor_catastral_terreno }}
            </div>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.valor_catastral_construccion.id_for_label }}">Valor Catastral de la Construcción (es):</label>
                {{ form.valor_catastral_construccion }}
            </div>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.valor_total_catastral.id_for_label }}">Valor Total Catastral (es):</label>
                {{ form.valor_total_catastral }}
            </div>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.fecha_valor_catastral.id_for_label }}">Fecha Valor Catastral:</label>
                {{ form.fecha_valor_catastral }}
            </div>
            <div class="form-group form-check-inline width-label">
                <label for="{{ form.documentacion_soporte.id_for_label }}">Documentación Soporte:</label>
                {{ form.documentacion_soporte }}
            </div>
        </div>

        <h3>Avaluos Registrados:</h3>
        <div class="table-responsive" id="tablaAvaluos">
        <table class="table">
            <thead>
                <tr>
                    <th>Número de Avalúo</th>
                    <th>Valor de Avalúo</th>
                    <th>Fecha Valor de Avalúo</th>
                    <th>Uso del Avalúo</th>
                    <th>Valor de Terreno</th>
                    <th>Valor de Construcción</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for avaluo in task.datosavaluos_set.all %}
                <tr>
                    <td>{{ avaluo.numero_de_avaluo }}</td>
                    <td>{{ avaluo.valor_de_avaluo }}</td>
                    <td>{{ avaluo.fecha_valor_de_avaluo }}</td>
                    <td>{{ avaluo.uso_del_avaluo }}</td>
                    <td>{{ avaluo.valor_de_terreno }}</td>
                    <td>{{ avaluo.valor_de_construccion }}</td>
                    <td >
                        <a href="{% url 'editar_avaluo' avaluo.id %}"  class="btn btn-outline-warning btn-sm">Editar</a>
                        <a href="{% url 'eliminar_avaluo' avaluo_id=avaluo.id %}" class="btn btn-outline-danger btn-sm" id="delete" onclick="return confirm('¿Estás seguro de que deseas eliminar este avalúo?')"> Eliminar Avalúo</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
        <div class="separador">
            <h4>
                Agregar nuevo Avalúo de Otras Instituciones:</h4>
            <form method="post" id="avaluoForm" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    <label for="{{ datos_avaluos_form.numero_de_avaluo.id_for_label }}">Número de Avalúo:</label>
                    {{ datos_avaluos_form.numero_de_avaluo }}
                </div>
                <div class="form-group form-check-inline width-label">
                    <label for="{{ datos_avaluos_form.valor_de_avaluo.id_for_label }}">Valor de Avalúo:</label>
                    {{ datos_avaluos_form.valor_de_avaluo }}
                </div>
                <div class="form-group form-check-inline width-label">
                    <label for="{{ datos_avaluos_form.fecha_valor_de_avaluo.id_for_label }}">Fecha Valor de Avalúo:</label>
                    {{ datos_avaluos_form.fecha_valor_de_avaluo }}
                </div>
                <div class="form-group ">
                    <label for="{{ datos_avaluos_form.uso_del_avaluo.id_for_label }}">Uso del Avalúo:</label>
                    {{ datos_avaluos_form.uso_del_avaluo }}
                </div>
                <div class="form-group form-check-inline width-label">
                    <label for="{{ datos_avaluos_form.valor_de_terreno.id_for_label }}">Valor de Terreno:</label>
                    {{ datos_avaluos_form.valor_de_terreno }}
                </div>
                <div class="form-group form-check-inline width-label">
                    <label for="{{ datos_avaluos_form.valor_de_construccion.id_for_label }}">Valor de Construcción:</label>
                    {{ datos_avaluos_form.valor_de_construccion }}
                </div>
                <button type="submit" id="guardarAvaluo" class="btn btn-outline-success">Guardar Avaluos</button>
            </form>
        </div>
     
       
      
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    
    $(document).ready(function() {
        // Agrega un manejador de eventos al botón "Guardar" de Documento de Ocupación
        $("#guardarAvaluo").click(function(event) {
            var formData = $("#avaluoForm").serialize();
            event.preventDefault();
    
            // Realiza una solicitud Ajax para guardar los datos del formulario de Documento de Ocupación
            $.ajax({
                url: "{% url 'guardar_Avaluo' task_id=task.id %}",
                type: "POST",
                data: formData,
                success: function(response) {
                    if (response.success) {
                        // Actualiza la tabla después de guardar
                        $("#tablaAvaluos").load("{% url 'task_detail' task_id=task.id %} #tablaAvaluos");
                        
                        // Restablece el formulario de Documento de Ocupación
                        $("#avaluoForm")[0].reset();
                    } else {
                        alert("Hubo un error al guardar el formulario de Avaluo.");
                    }
                },
                error: function() {
                    alert("Se produjo un error al enviar el formulario de Avaluo");
                },
            });
        });
    });
</script>
